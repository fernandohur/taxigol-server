<div id="map-canvas"/>
<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAgGzKuhM7giCRIAY-4BAmW8pGVhyZyfnc&sensor=false">
</script>
<script type="text/javascript">
    var map = null;
    function addMarker(map, lat, lon)
    {
        var myLatlng = new google.maps.LatLng(lat,lon);

        var marker = new google.maps.Marker({
            position: myLatlng,
            title:"Hello World!",
            icon:"<%= image_path "/assets/taxi.png"  %>"
        });

        marker.setMap(map);
    }

    function initialize() {
        var mapOptions = {
            center: new google.maps.LatLng(4.6023996, -74.0655158),
            zoom: 8,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);
    <% @taxis.each do |t|%>
    <% e = t.get_last_position %>
    <%    if e!= nil then %>
    <% lat = e.latitude %>
    <% lon = e.longitude %>
    var latitude = <%= lat%>;
    var longitude = <%= lon%>;
    addMarker(map,latitude,longitude);
    <%end%>
    <% end %>


    }
    google.maps.event.addDomListener(window, 'load', initialize);



</script>